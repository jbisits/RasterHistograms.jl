<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Histograms from Rasters · RasterHistograms.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://jbisits.github.io/RasterHistograms.jl/literated/raster_histograms/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RasterHistograms.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../../modules/RasterHistograms/">RasterHistograms</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Histograms from <code>Raster</code>s</a><ul class="internal"><li><a class="tocitem" href="#Randomly-generated-toy-data"><span>Randomly generated toy data</span></a></li><li><a class="tocitem" href="#Real-world-data-example"><span>Real world data example</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Histograms from <code>Raster</code>s</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Histograms from <code>Raster</code>s</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jbisits/RasterHistograms.jl/blob/main/examples/raster_histograms.jl#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="raster_hist_example"><a class="docs-heading-anchor" href="#raster_hist_example">Raster Histograms</a><a id="raster_hist_example-1"></a><a class="docs-heading-anchor-permalink" href="#raster_hist_example" title="Permalink"></a></h1><p>First, add the required depedencies</p><pre><code class="language- hljs">using Rasters, NCDatasets, Downloads, CairoMakie</code></pre><p>and the <code>RasterHistograms</code> package.</p><pre><code class="language-julia hljs">using RasterHistograms</code></pre><p>Using this package we can produce <code>Histogram</code>s from data that is in a <code>Raster</code>, <code>RasterStack</code> or <code>RasterSeries</code>, which are N-dimensional arrays, in a similar way that <a href="https://xhistogram.readthedocs.io/en/latest/index.html">xhistogram</a> works for xarray in python. This example is structured similarly to the <a href="https://xhistogram.readthedocs.io/en/latest/tutorial.html">xhistogram tutorial</a>.</p><h2 id="Randomly-generated-toy-data"><a class="docs-heading-anchor" href="#Randomly-generated-toy-data">Randomly generated toy data</a><a id="Randomly-generated-toy-data-1"></a><a class="docs-heading-anchor-permalink" href="#Randomly-generated-toy-data" title="Permalink"></a></h2><p>First we generate some randomly distributed data and form a <code>Raster</code>.</p><pre><code class="language- hljs">x, t = range(-2π, 2π; length = 50), range(0, 4π; length = 100)
dimensions = (X(x), Ti(t))
rs = Raster(randn(length(x), length(t)), dimensions; name = :Toy_data)</code></pre><p>The we can form a <code>RasterLayerHistogram</code> for the <code>:Toy_data</code></p><pre><code class="language- hljs">rs_hist = RasterLayerHistogram(rs)</code></pre><p>We can then plot the data and the <code>Histogram</code></p><pre><code class="language- hljs">fig = Figure(size = (1000, 600))
ax1 = Axis(fig[1, 1];
           title = &quot;Toy data&quot;,
           xlabel = &quot;x&quot;,
           ylabel = &quot;time&quot;)
hm = heatmap!(ax1, x, t, rs.data)
Colorbar(fig[2, 1], hm; vertical = false, flipaxis = false)
ax2 = Axis(fig[1, 2];
          title = &quot;Histogram of Toy data&quot;,
          xlabel = &quot;Toy data&quot;, ylabel = &quot;Counts&quot;)
plot!(ax2, rs_hist; color = :steelblue)
fig</code></pre><p>By default the <code>Histogram</code> has the counts in each bin. We can normalise the <code>Histogram</code> by calling the <code>normalize!</code> function on <code>rs_hist</code> and choosing a <code>mode</code> of normalisation. For more information about the possible modes of normalisation <a href="https://juliastats.org/StatsBase.jl/latest/empirical/#LinearAlgebra.normalize">see here</a>.</p><pre><code class="language- hljs">normalize!(rs_hist; mode = :pdf)</code></pre><p>Then replot with the normalised histogram</p><pre><code class="language- hljs">fig = Figure(size = (900, 600))
ax1 = Axis(fig[1, 1];
           title = &quot;Toy data&quot;,
           xlabel = &quot;x&quot;,
           ylabel = &quot;time&quot;)
hm = heatmap!(ax1, x, t, rs.data)
Colorbar(fig[2, 1], hm; vertical = false, flipaxis = false)
ax2 = Axis(fig[1, 2];
          title = &quot;Histogram (pdf) of Toy data&quot;,
          xlabel = &quot;Toy data&quot;, ylabel = &quot;density&quot;)
plot!(ax2, rs_hist; color = :steelblue)
fig</code></pre><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Plotting using <a href="https://docs.juliaplots.org/latest/">Plots.jl</a> is also possible. See the <a href="../../modules/RasterHistograms/#raster_hist_module">module documentation</a> for more info.</p></div></div><h2 id="Real-world-data-example"><a class="docs-heading-anchor" href="#Real-world-data-example">Real world data example</a><a id="Real-world-data-example-1"></a><a class="docs-heading-anchor-permalink" href="#Real-world-data-example" title="Permalink"></a></h2><p>This package is mainly concerned with ocean variables, so we now look at temperature and salinity distributions using ECCO model output.</p><pre><code class="language- hljs">Downloads.download(&quot;https://opendap.earthdata.nasa.gov/providers/POCLOUD/collections/ECCO%2520Ocean%2520Temperature%2520and%2520Salinity%2520-%2520Daily%2520Mean%25200.5%2520Degree%2520(Version%25204%2520Release%25204)/granules/OCEAN_TEMPERATURE_SALINITY_day_mean_2007-01-01_ECCO_V4r4_latlon_0p50deg.dap.nc4&quot;, &quot;ECCO_data.nc&quot;)</code></pre><p>This example also shows how the module works for 2-dimensional <code>Histograms</code> though it can be generalised to N dimensions depending on the number of variables (i.e. layers in the <code>RasterStack</code>) one is looking at.</p><h3 id="Forming-the-RasterStack"><a class="docs-heading-anchor" href="#Forming-the-RasterStack">Forming the <code>RasterStack</code></a><a id="Forming-the-RasterStack-1"></a><a class="docs-heading-anchor-permalink" href="#Forming-the-RasterStack" title="Permalink"></a></h3><p>We form a <code>RasterStack</code> with only the <code>:SALT</code> (practical salinity) and <code>:THETA</code> (potential temperature) layers. This means the resulting <code>RasterStackHistogram</code> will be 2 dimensional. Note the order of the variables matters here for plotting purposes. The first layer, in this case <code>:SALT</code> will be the x-axis, and the second layer <code>:THETA</code> will be the y-axis.</p><pre><code class="language- hljs">stack_TS = RasterStack(&quot;ECCO_data.nc&quot;; name = (:SALT, :THETA))
edges = (31:0.025:38, -2:0.1:32)
stack_hist = RasterStackHistogram(stack_TS, edges)</code></pre><p>Now we can plot, the histogram and look at the unweighted distribtution of temperature and salinity. By default the empty bins are plotted with the value of zero. To not plot the empty bins argument we pass <code>show_empty_bins = false</code> to the plotting function.</p><pre><code class="language- hljs">fig = Figure(size = (500, 500))
ax = Axis(fig[1, 1];
          title = &quot;Temperature and salinity joint distribution (unweighted)&quot;,
          xlabel = &quot;Practical salinity (psu)&quot;,
          ylabel = &quot;Potential temperature (°C)&quot;)
hm = heatmap!(ax, stack_hist; colorscale = log10)
Colorbar(fig[1, 2], hm)
fig</code></pre><h3 id="Weighting-the-Histogram"><a class="docs-heading-anchor" href="#Weighting-the-Histogram">Weighting the <code>Histogram</code></a><a id="Weighting-the-Histogram-1"></a><a class="docs-heading-anchor-permalink" href="#Weighting-the-Histogram" title="Permalink"></a></h3><p>The module also exports simple functions for calculating area and volume weights from the dimensions of the grid and plot the data. Where weights are available from model data they should be used in favour of the functions.</p><pre><code class="language- hljs">dV = volume_weights(stack_TS)
weighted_stack_hist = RasterStackHistogram(stack_TS, dV, edges)
fig = Figure(size = (500, 500))
ax = Axis(fig[1, 1];
          title = &quot;Temperature and salinity joint distribution (weighted)&quot;,
          xlabel = &quot;Practical salinity (psu)&quot;,
          ylabel = &quot;Potential temperature (°C)&quot;)
hm = heatmap!(ax, weighted_stack_hist; colorscale = log10)
Colorbar(fig[1, 2], hm)
fig</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../modules/RasterHistograms/">« RasterHistograms</a><a class="docs-footer-nextpage" href="../../library/function_index/">Function index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 2 September 2023 10:56">Saturday 2 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
